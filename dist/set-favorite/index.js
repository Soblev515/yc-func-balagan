import e from"ydb-sdk";import{z as n}from"zod";function t(e,n,t,r){return new(t||(t=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function d(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,d)}u((r=r.apply(e,n||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const{Driver:r,TypedData:o,getCredentialsFromEnv:i,getLogger:s}=e,d=e=>o.createNativeObjects(e),u=e=>t(void 0,void 0,void 0,(function*(){const n=s({level:"debug"}),o=(()=>{const e=process.env.DB_ENDPOINT,n=process.env.DB_DATABASE,t=i();return new r({endpoint:e,database:n,authService:t})})();if(!(yield o.ready(1e4))){const e="Driver has not become ready in 10 seconds!";throw n.fatal(e),new Error(e)}const u=yield o.tableClient.withSession((n=>t(void 0,void 0,void 0,(function*(){var t;const r=yield n.prepareQuery(e);return(null!==(t=(yield n.executeQuery(r)).resultSets)&&void 0!==t?t:[]).map(d)}))));return o.destroy(),u})),a=n.object({event_id:n.string()}),c=function(e,n){return t(this,void 0,void 0,(function*(){const t=a.parse(n.getPayload()),r=atob(e.headers.Authorization.split(" ")[1]).split(":"),o=(i=r[0],s=r[1],`\n    DECLARE $login AS String;\n    DECLARE $password AS String;\n\n    $login = "${i}";\n    $password = "${s}";\n\n    SELECT user_id FROM auth \n    WHERE login = $login \n    AND password = $password\n`);var i,s;const d=yield u(o);console.log(d[0][0].user_id),console.log(d[0].user_id);const c=((e,{event_id:n})=>`\n    DECLARE $event_id AS String;\n    DECLARE $user_id AS String;\n\n    $user_id = "${e}";\n    $event_id = "${n}";\n    \n    UPSERT INTO favorite_user_event (user_id, event_id)\n    Values ($user_id, $event_id)\n`)(d[0][0].user_id,t);return yield u(c),{statusCode:200,body:"Ok"}}))};export{c as handler};
