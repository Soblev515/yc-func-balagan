import n from"ydb-sdk";function e(n,e,o,t){return new(o||(o=Promise))((function(r,i){function s(n){try{a(t.next(n))}catch(n){i(n)}}function d(n){try{a(t.throw(n))}catch(n){i(n)}}function a(n){var e;n.done?r(n.value):(e=n.value,e instanceof o?e:new o((function(n){n(e)}))).then(s,d)}a((t=t.apply(n,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const{Driver:o,TypedData:t,getCredentialsFromEnv:r,getLogger:i}=n,s=n=>t.createNativeObjects(n),d=n=>e(void 0,void 0,void 0,(function*(){const t=i({level:"debug"}),d=(()=>{const n=process.env.DB_ENDPOINT,e=process.env.DB_DATABASE,t=r();return new o({endpoint:n,database:e,authService:t})})();if(!(yield d.ready(1e4))){const n="Driver has not become ready in 10 seconds!";throw t.fatal(n),new Error(n)}const a=yield d.tableClient.withSession((o=>e(void 0,void 0,void 0,(function*(){var e;const t=yield o.prepareQuery(n);return(null!==(e=(yield o.executeQuery(t)).resultSets)&&void 0!==e?e:[]).map(s)}))));return d.destroy(),a})),a=function(n,o){return e(this,void 0,void 0,(function*(){console.log(n.headers),console.log(n.headers.Authorization);const e=atob(n.headers.Authorization.split(" ")[1]).split(":");console.log(e);const o=(t=e[0],r=e[1],`\n    DECLARE $login AS String;\n    DECLARE $password AS String;\n\n    $login = "${t}";\n    $password = "${r}";\n\n    SELECT user_id FROM auth \n    WHERE login = $login \n    AND password = $password\n`);var t,r;const i=yield d(o);console.log(i);const s=`\n    DECLARE $user_id AS String;\n\n    $user_id = "${i[0][0].user_id}";\n    \n    Select t.* from \`tag\` as t\n    Left Join \`user_tags\` as ut\n    on t.tag_id = ut.tag_id\n    Where user_id = $user_id\n`;const a=yield d(s);return console.log(a),{statusCode:200,body:JSON.stringify(a[0])}}))};export{a as handler};
